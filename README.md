# Overview

This repo contains a minimal reproduction for an issue that I and my coworkers
are experiencing when attempting to configure a project to allow debugging into
a docker container

The project here is just a default C#/.NET6 console project with a few changes:
- Updated [the .csproj file](./DotnetDockerDebugRepro/DotnetDockerDebugRepro.csproj#L10)
  to assign a value to the `OutputPath` property which triggers the issue.

- Added a [Directory.Build.props](./Directory.Build.props) to set up the value
  that is assigned to the `OutputPath`.

- Added a [Dockerfile](/DotnetDockerDebugRepro/Dockerfile) was added that
  produces an image with the console app's build outputs.

- Set up build tasks and a launch configuration based on the entries generated
  by the scaffolding.


# Reproduction steps

1. Clone this repository.

2. Open the folder in VS Code with the `ms-azuretools.vscode-docker` and
   `ms-dotnettools.csharp` extensions installed.

3. Set a breakpoint on the `Console.WriteLine` call in Program.cs.

4. Launch the "Docker .NET Core Launch" configuration.

Expected behavior: The build completes, the debugger is launched, and execution stops at the breakpoint.

Actual behavior: The build completes, the debugger is launched, but fails to
launch the application. The Debug Output includes messages stating that the
application DLL was not found, and that the target process exited without
raising a CoreCLR started event.


# Other notes

When I follow the repro steps above, I see the following in my Debug Output:
```plaintext
Starting: "docker" exec -i dockerdebugrepro-dev /remote_debugger/vsdbg --interpreter=vscode
-------------------------------------------------------------------
You may only use the Microsoft .NET Core Debugger (vsdbg) with
Visual Studio Code, Visual Studio or Visual Studio for Mac software
to help you develop and test your applications.
-------------------------------------------------------------------
The command could not be loaded, possibly because:
  * You intended to execute a .NET application:
      The application '/app/home/the-nerbs/src/docker-debug-repro/artifacts/DotnetDockerDebugRepro/net6.0/DotnetDockerDebugRepro.dll' does not exist.
  * You intended to execute a .NET SDK command:
      No .NET SDKs were found.

Download a .NET SDK:
https://aka.ms/dotnet-download

Learn about SDK resolution:
https://aka.ms/dotnet/sdk-not-found
The target process exited without raising a CoreCLR started event. Ensure that the target process is configured to use .NET Core. This may be expected if the target process did not run on .NET Core.
The program '[25] dotnet' has exited with code 145 (0x91).
```

However, If I comment out the assignment to `OutputPath` in the csproj so it
retains its default value (`bin/Debug/net6.0/`, relative to the project
directory) and try launching the debugger again, then it works as expected.

I tried to track down the `/app/home/...` path that's in the debug output, and
found the same path being generated by the extension's
`NetCoreDebugHelper.resolveLaunchDebugConfiguration` function:
https://github.com/microsoft/vscode-docker/blob/451b11744e1fc8490226427f666f21eeedf03116/src/debugging/netcore/NetCoreDebugHelper.ts#L96

I haven't been able to debug into VSCode itself though, so I am not sure if
this is where the path in the debug output is really coming from.